<Window x:Class="SpecDocGenerator.WPF.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:SpecDocGenerator.WPF.ViewModels"
        mc:Ignorable="d"
        Title="設定 / Settings" Height="600" Width="600"
        WindowStartupLocation="CenterOwner">
    
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Margin" Value="5,5,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0">
            <!-- LLM Settings Tab -->
            <TabItem Header="LLM設定">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <GroupBox Header="プロバイダ / Provider" Padding="10" Margin="0,0,0,10">
                            <StackPanel>
                                <RadioButton Content="Azure OpenAI" IsChecked="True" Margin="5"/>
                                <RadioButton Content="ローカルLLM (Ollama)" IsEnabled="False" Margin="5"
                                           ToolTip="今後実装予定"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Azure OpenAI 設定" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="エンドポイント:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding AzureOpenAiEndpoint}"
                                       ToolTip="例: https://your-resource.openai.azure.com/"/>

                                <Label Grid.Row="1" Grid.Column="0" Content="APIキー:" VerticalAlignment="Center"/>
                                <PasswordBox Grid.Row="1" Grid.Column="1" Name="ApiKeyBox" Margin="5" Padding="5"
                                           ToolTip="Azure OpenAI のAPIキー"/>

                                <Label Grid.Row="2" Grid.Column="0" Content="デプロイ名:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding AzureOpenAiDeployment}"
                                       ToolTip="例: gpt-4, gpt-35-turbo"/>

                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="5">
                                    <Button Content="接続テスト" Command="{Binding TestConnectionCommand}"/>
                                    <TextBlock Text="※環境変数として保存されます" VerticalAlignment="Center" 
                                             Margin="10,0,0,0" Foreground="Gray" FontSize="10"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="LLMパラメータ" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="温度 (Temperature):" VerticalAlignment="Center"/>
                                <Slider Grid.Row="0" Grid.Column="1" Minimum="0" Maximum="2" 
                                      Value="{Binding Temperature}" TickFrequency="0.1" 
                                      IsSnapToTickEnabled="True" Margin="5"/>
                                <Label Grid.Row="0" Grid.Column="2" Content="{Binding Temperature, StringFormat='{}{0:F1}'}" 
                                     Width="40"/>

                                <Label Grid.Row="1" Grid.Column="0" Content="最大トークン数:" VerticalAlignment="Center"/>
                                <Slider Grid.Row="1" Grid.Column="1" Minimum="1000" Maximum="8000" 
                                      Value="{Binding MaxTokens}" TickFrequency="1000" 
                                      IsSnapToTickEnabled="True" Margin="5"/>
                                <Label Grid.Row="1" Grid.Column="2" Content="{Binding MaxTokens}" Width="40"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Processing Settings Tab -->
            <TabItem Header="処理設定">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <GroupBox Header="チャンク設定" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="チャンクサイズ:" VerticalAlignment="Center"/>
                                <Slider Grid.Row="0" Grid.Column="1" Minimum="1000" Maximum="8000" 
                                      Value="{Binding ChunkSize}" TickFrequency="1000" 
                                      IsSnapToTickEnabled="True" Margin="5"/>
                                <Label Grid.Row="0" Grid.Column="2" Content="{Binding ChunkSize}" Width="50"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="並列処理" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="並列度:" VerticalAlignment="Center"/>
                                <Slider Grid.Row="0" Grid.Column="1" Minimum="1" Maximum="8" 
                                      Value="{Binding Parallelism}" TickFrequency="1" 
                                      IsSnapToTickEnabled="True" Margin="5"/>
                                <Label Grid.Row="0" Grid.Column="2" Content="{Binding Parallelism}" Width="30"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="リトライ設定" Padding="10" Margin="0,0,0,10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="再試行回数:" VerticalAlignment="Center"/>
                                <Slider Grid.Row="0" Grid.Column="1" Minimum="0" Maximum="5" 
                                      Value="{Binding RetryCount}" TickFrequency="1" 
                                      IsSnapToTickEnabled="True" Margin="5"/>
                                <Label Grid.Row="0" Grid.Column="2" Content="{Binding RetryCount}" Width="30"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="ログ設定" Padding="10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Row="0" Grid.Column="0" Content="ログ保存先:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding LogPath}"/>
                                <Button Grid.Row="0" Grid.Column="2" Content="参照..." 
                                      Command="{Binding SelectLogPathCommand}"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="保存 / Save" Command="{Binding SaveSettingsCommand}" IsDefault="True"/>
            <Button Content="読込 / Load" Command="{Binding LoadSettingsCommand}"/>
            <Button Content="閉じる / Close" IsCancel="True" Click="CloseButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
